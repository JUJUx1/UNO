<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>UNO Classic</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --card-w: 68px;
    --card-h: 104px;
    --radius: 10px;
    --gold: #FFD700;
    --red: #E8192C;
    --green: #1E9E46;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito Sans', sans-serif;
    background: radial-gradient(ellipse at center, #1a4a2a 0%, #0a2a15 60%, #051510 100%);
    min-height: 100vh;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    position: relative;
    user-select: none;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(255,255,255,0.012) 2px, rgba(255,255,255,0.012) 4px);
    pointer-events: none;
    z-index: 0;
  }

  /* ======= LOADING SCREEN ======= */
  #loadScreen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: radial-gradient(ellipse at center, #1a4a2a 0%, #0a2a15 60%, #051510 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  #loadScreen::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(255,255,255,0.012) 2px, rgba(255,255,255,0.012) 4px);
  }

  #loadScreen.out {
    opacity: 0;
    transform: scale(1.05);
    pointer-events: none;
  }

  .ls-deco {
    position: absolute;
    width: 72px;
    height: 110px;
    border-radius: 10px;
    overflow: hidden;
    pointer-events: none;
  }
  .ls-deco img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .ls-deco:nth-child(1) { top:-25px;    left:-25px;    transform:rotate(-22deg); opacity:0.15; }
  .ls-deco:nth-child(2) { top:-25px;    right:-25px;   transform:rotate(22deg);  opacity:0.15; }
  .ls-deco:nth-child(3) { bottom:-25px; left:-25px;    transform:rotate(16deg);  opacity:0.12; }
  .ls-deco:nth-child(4) { bottom:-25px; right:-25px;   transform:rotate(-16deg); opacity:0.12; }
  .ls-deco:nth-child(5) { top:50%;      left:-38px;    transform:translateY(-50%) rotate(-10deg); opacity:0.08; }
  .ls-deco:nth-child(6) { top:50%;      right:-38px;   transform:translateY(-50%) rotate(10deg);  opacity:0.08; }

  .ls-logo {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 96px;
    color: var(--gold);
    letter-spacing: -4px;
    transform: rotate(-5deg);
    text-shadow: 0 0 40px rgba(255,215,0,0.7), 3px 3px 0 #b8860b, 6px 6px 0 #7a5a00;
    animation: logoPulse 1.4s ease-in-out infinite;
    position: relative;
    z-index: 2;
    margin-bottom: 4px;
  }

  @keyframes logoPulse {
    0%,100% { text-shadow: 0 0 40px rgba(255,215,0,0.7), 3px 3px 0 #b8860b, 6px 6px 0 #7a5a00; }
    50%      { text-shadow: 0 0 80px rgba(255,215,0,1),   3px 3px 0 #b8860b, 6px 6px 0 #7a5a00; }
  }

  .ls-sub {
    font-family: 'Nunito Sans', sans-serif;
    font-weight: 700;
    font-size: 12px;
    color: rgba(255,255,255,0.4);
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-bottom: 52px;
    position: relative;
    z-index: 2;
  }

  .ls-bar-wrap {
    width: 180px;
    height: 6px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    z-index: 2;
  }

  .ls-bar {
    height: 100%;
    width: 0;
    border-radius: 10px;
    background: linear-gradient(90deg, var(--gold), #ff8c00);
    box-shadow: 0 0 10px rgba(255,165,0,0.8);
    transition: width 1.3s cubic-bezier(0.4,0,0.2,1);
  }

  .ls-loading {
    margin-top: 14px;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 11px;
    color: rgba(255,255,255,0.3);
    letter-spacing: 2px;
    position: relative;
    z-index: 2;
    animation: blink 0.9s ease-in-out infinite alternate;
  }

  @keyframes blink { from { opacity: 0.3; } to { opacity: 0.8; } }

  .ls-tap-btn {
    display: none;
    margin-top: 28px;
    position: relative;
    z-index: 2;
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 18px;
    color: #1a0a00;
    background: linear-gradient(145deg, var(--gold), #ff8c00);
    border: none;
    padding: 14px 48px;
    border-radius: 40px;
    cursor: pointer;
    box-shadow: 0 6px 24px rgba(255,165,0,0.55), 0 2px 0 #7a3a00;
    animation: tapPulse 1.3s ease-in-out infinite;
    -webkit-tap-highlight-color: transparent;
  }

  @keyframes tapPulse {
    0%,100% { transform: scale(1);    box-shadow: 0 6px 24px rgba(255,165,0,0.55); }
    50%      { transform: scale(1.07); box-shadow: 0 8px 36px rgba(255,165,0,0.85); }
  }

  /* ======= HEADER ======= */
  .header {
    width: 100%;
    padding: 8px 16px 4px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 10;
    position: relative;
    flex-shrink: 0;
  }

  .logo {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 30px;
    color: var(--gold);
    text-shadow: 0 0 20px rgba(255,215,0,0.5), 2px 2px 0 #b8860b, 4px 4px 0 #7a5a00;
    letter-spacing: -1px;
    transform: rotate(-3deg);
  }

  .status-bar { display: flex; flex-direction: column; align-items: flex-end; gap: 3px; }

  .turn-indicator {
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: 13px;
    color: #fff;
    background: rgba(255,255,255,0.15);
    padding: 4px 12px;
    border-radius: 20px;
    backdrop-filter: blur(4px);
    transition: background 0.3s, color 0.3s;
  }

  .turn-indicator.your-turn {
    background: linear-gradient(135deg, var(--gold), #ff8c00);
    color: #1a0a00;
    animation: pulseTurn 1.2s ease-in-out infinite;
  }

  @keyframes pulseTurn {
    0%,100% { transform: scale(1); }
    50%      { transform: scale(1.05); }
  }

  .dir-badge { font-size: 10px; color: rgba(255,255,255,0.5); font-weight: 700; letter-spacing: 0.5px; }

  /* ======= OPPONENT ======= */
  .opponent-area {
    width: 100%;
    padding: 2px 12px 4px;
    z-index: 10;
    position: relative;
    flex-shrink: 0;
  }

  .player-info { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }

  .avatar {
    width: 30px; height: 30px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
    background: linear-gradient(135deg, #e8192c, #8b0000);
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    flex-shrink: 0;
    position: relative;
  }

  .avatar.active::after {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 50%;
    border: 2px solid var(--gold);
    animation: spinRing 2s linear infinite;
  }

  @keyframes spinRing { to { transform: rotate(360deg); } }

  .pname { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 13px; color: white; }
  .pcount { font-size: 11px; color: rgba(255,255,255,0.55); font-weight: 600; }

  .uno-badge {
    font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 11px;
    background: var(--red); color: white;
    padding: 2px 8px; border-radius: 10px;
    animation: unoFlash 0.6s ease-in-out infinite alternate;
    box-shadow: 0 2px 8px rgba(232,25,44,0.5);
    margin-left: auto;
  }

  @keyframes unoFlash { from { transform: scale(1); } to { transform: scale(1.1); } }

  .bot-hand {
    display: flex;
    justify-content: center;
    flex-wrap: nowrap;
    overflow: hidden;
    min-height: calc(var(--card-h) * 0.65);
    align-items: center;
  }

  .bot-card {
    width: var(--card-w); height: var(--card-h);
    flex-shrink: 0;
    margin-left: -22px;
    border-radius: var(--radius);
    box-shadow: 0 3px 10px rgba(0,0,0,0.55);
    overflow: hidden;
    transform: scale(0.65);
    transform-origin: top center;
  }

  .bot-card:first-child { margin-left: 0; }
  .bot-card img { width: 100%; height: 100%; object-fit: cover; display: block; border-radius: var(--radius); pointer-events: none; }

  .thinking { display: flex; gap: 5px; justify-content: center; padding: 4px 0 0; }
  .dot {
    width: 6px; height: 6px;
    background: rgba(255,255,255,0.4);
    border-radius: 50%;
    animation: dotBounce 0.8s ease-in-out infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.15s; }
  .dot:nth-child(3) { animation-delay: 0.3s; }
  @keyframes dotBounce { 0%,100% { transform:translateY(0);opacity:0.4; } 50% { transform:translateY(-5px);opacity:1; } }

  /* ======= CENTER ======= */
  .center-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    z-index: 10;
    position: relative;
    width: 100%;
    padding: 0 12px;
    min-height: 0;
  }

  .pile-wrap { display: flex; flex-direction: column; align-items: center; gap: 5px; }
  .pile-label { font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 10px; color: rgba(255,255,255,0.45); text-transform: uppercase; letter-spacing: 1px; }

  .deck-stack {
    width: var(--card-w); height: var(--card-h);
    position: relative;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }

  .deck-stack .sh { position: absolute; inset: 0; border-radius: var(--radius); background: rgba(0,0,0,0.32); }
  .deck-stack .sh:nth-child(1) { transform: translate(4px,4px); }
  .deck-stack .sh:nth-child(2) { transform: translate(2px,2px); }

  .deck-top {
    position: absolute; inset: 0;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 4px 14px rgba(0,0,0,0.6);
    transition: transform 0.15s;
  }
  .deck-top img { width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }
  .deck-stack:active .deck-top { transform: scale(0.93) translateY(3px); }

  .discard-pile {
    width: var(--card-w); height: var(--card-h);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    transition: box-shadow 0.35s;
  }
  .discard-pile img { width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }

  .game-mid { display: flex; flex-direction: column; align-items: center; gap: 8px; }

  .color-swatch {
    width: 30px; height: 30px;
    border-radius: 50%;
    border: 3px solid white;
    transition: background 0.35s, box-shadow 0.35s;
  }

  .color-label { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; }

  /* ======= PLAYER HAND ======= */
  .player-area { width: 100%; padding: 0 8px 8px; z-index: 10; position: relative; flex-shrink: 0; }

  .your-info { display: flex; align-items: center; justify-content: space-between; padding: 0 8px; margin-bottom: 4px; }
  .your-name { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 13px; color: var(--gold); }
  .your-count { font-size: 11px; color: rgba(255,255,255,0.55); font-weight: 600; }

  .scroll-hint { text-align: center; font-size: 10px; color: rgba(255,255,255,0.25); font-weight: 600; min-height: 14px; }

  .hand-container {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding: 22px 16px 4px;
    min-height: calc(var(--card-h) + 28px);
  }
  .hand-container::-webkit-scrollbar { display: none; }

  .hand-card {
    width: var(--card-w); height: var(--card-h);
    border-radius: var(--radius);
    flex-shrink: 0;
    margin-left: -18px;
    cursor: pointer;
    position: relative;
    transform-origin: bottom center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.55);
    overflow: visible;
    -webkit-tap-highlight-color: transparent;
    transition: transform 0.22s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, filter 0.2s;
  }
  .hand-card:first-child { margin-left: 0; }
  .hand-card img { width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius); display: block; pointer-events: none; }

  /* Playable â€” hover lift */
  .hand-card.playable:hover, .hand-card.playable:focus {
    transform: translateY(-20px) scale(1.07);
    z-index: 50;
    box-shadow: 0 14px 28px rgba(0,0,0,0.6);
  }

  /* Not playable â€” dim */
  .hand-card.dead { filter: brightness(0.45) saturate(0.3); cursor: not-allowed; }

  /* SELECTED â€” gold ring + lift */
  .hand-card.selected {
    transform: translateY(-30px) scale(1.12);
    z-index: 60;
    box-shadow: 0 20px 40px rgba(0,0,0,0.7), 0 0 0 3px var(--gold), 0 0 20px rgba(255,215,0,0.5);
  }

  /* "Tap to play" bubble on selected card */
  .tap-label {
    display: none;
    position: absolute;
    top: -28px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--gold);
    color: #1a0a00;
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 10px;
    padding: 3px 9px;
    border-radius: 10px;
    white-space: nowrap;
    pointer-events: none;
    z-index: 10;
    animation: tapFloat 0.55s ease-in-out infinite alternate;
  }
  .hand-card.selected .tap-label { display: block; }
  @keyframes tapFloat { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-4px); } }

  /* â”€â”€ Card pick-up (select) shimmer â”€â”€ */
  @keyframes cardPickUp {
    0%   { transform: translateY(0) scale(1); box-shadow: 0 4px 12px rgba(0,0,0,0.55); }
    40%  { transform: translateY(-38px) scale(1.15) rotate(-2deg); box-shadow: 0 24px 40px rgba(0,0,0,0.7), 0 0 0 3px var(--gold), 0 0 30px rgba(255,215,0,0.6); }
    70%  { transform: translateY(-30px) scale(1.12) rotate(0deg); }
    100% { transform: translateY(-30px) scale(1.12); box-shadow: 0 20px 40px rgba(0,0,0,0.7), 0 0 0 3px var(--gold), 0 0 20px rgba(255,215,0,0.5); }
  }

  .hand-card.selected { animation: cardPickUp 0.32s cubic-bezier(0.34,1.56,0.64,1) forwards; }

  /* Shimmer sweep overlay on selected card */
  .hand-card.selected::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: var(--radius);
    background: linear-gradient(115deg, transparent 30%, rgba(255,255,255,0.35) 50%, transparent 70%);
    background-size: 200% 100%;
    animation: shimmerSweep 0.5s ease forwards;
    pointer-events: none;
    z-index: 5;
  }
  @keyframes shimmerSweep {
    0%   { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* â”€â”€ Card draw â€” flies from deck to hand â”€â”€ */
  @keyframes cardDealIn {
    0%   { transform: translate(var(--dx), var(--dy)) scale(0.7) rotate(-12deg); opacity: 0; }
    60%  { opacity: 1; }
    80%  { transform: translate(calc(var(--dx)*0.05), calc(var(--dy)*0.05)) scale(1.08) rotate(1deg); }
    100% { transform: translate(0,0) scale(1) rotate(0deg); opacity: 1; }
  }
  .hand-card.deal-in {
    animation: cardDealIn 0.42s cubic-bezier(0.22,1,0.36,1) forwards;
  }

  /* â”€â”€ Card throw â€” flies from hand to discard â”€â”€ */
  @keyframes cardThrow {
    0%   { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-120px) scale(0.6) rotate(15deg); opacity: 0; }
  }
  .hand-card.throwing {
    animation: cardThrow 0.28s ease-in forwards;
    pointer-events: none;
    z-index: 100;
  }

  /* â”€â”€ Discard pile card pop-in â”€â”€ */
  @keyframes discardPopIn {
    0%   { transform: scale(0.6) rotate(-15deg); opacity: 0; }
    70%  { transform: scale(1.08) rotate(2deg); opacity: 1; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }
  .discard-pile.pop-in {
    animation: discardPopIn 0.3s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }

  /* â”€â”€ Bot card draw â€” flies from deck area downward â”€â”€ */
  @keyframes botDealIn {
    0%   { transform: scale(0.7) translateY(-30px) rotate(8deg); opacity: 0; }
    70%  { transform: scale(1.05) translateY(4px) rotate(-1deg); opacity: 1; }
    100% { transform: scale(0.65) translateY(0) rotate(0deg); opacity: 1; }
  }
  .bot-card.deal-in {
    animation: botDealIn 0.35s cubic-bezier(0.22,1,0.36,1) forwards;
  }

  /* ======= ACTION BAR ======= */
  .action-bar {
    display: flex; justify-content: center; gap: 16px;
    padding: 4px 16px 10px;
    z-index: 10; position: relative; flex-shrink: 0;
  }

  .btn {
    background: none; border: none; padding: 0;
    cursor: pointer; -webkit-tap-highlight-color: transparent;
    transition: transform 0.15s, filter 0.15s, opacity 0.2s;
    display: flex; align-items: center; justify-content: center;
  }

  .btn img {
    height: 52px; width: auto; display: block;
    pointer-events: none;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.45));
    transition: filter 0.2s;
  }

  .btn:active { transform: scale(0.91) translateY(3px); }
  .btn:disabled { opacity: 0.35; cursor: not-allowed; }
  .btn:disabled img { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)) grayscale(0.6); }

  /* UNO button pulses red glow when enabled */
  .btn-uno:not(:disabled) img {
    animation: unoPulse 2s ease-in-out infinite;
  }
  @keyframes unoPulse {
    0%,100% { filter: drop-shadow(0 4px 8px rgba(232,25,44,0.5)); }
    50%      { filter: drop-shadow(0 4px 20px rgba(232,25,44,1)); }
  }

  /* ======= MODALS ======= */
  .overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.72);
    backdrop-filter: blur(7px);
    display: flex; align-items: center; justify-content: center;
    z-index: 500;
    animation: fadeIn 0.2s ease;
  }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .modal {
    background: linear-gradient(145deg, #1a0838, #2d1b4e);
    border: 1.5px solid rgba(255,255,255,0.13);
    border-radius: 22px;
    padding: 28px 22px 22px;
    text-align: center;
    box-shadow: 0 24px 60px rgba(0,0,0,0.75);
    animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
    max-width: 300px; width: 88%;
  }
  @keyframes slideUp { from { transform:translateY(36px) scale(0.88); opacity:0; } to { transform:translateY(0) scale(1); opacity:1; } }

  .modal-title { font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 20px; color: var(--gold); margin-bottom: 14px; }
  .modal-sub { font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 18px; }

  .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .color-btn {
    height: 54px; border-radius: 14px;
    border: 3px solid rgba(255,255,255,0.18);
    cursor: pointer;
    font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 15px;
    color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    transition: transform 0.15s, border-color 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .color-btn:hover, .color-btn:active { transform: scale(1.07); border-color: white; }
  .cb-red    { background: linear-gradient(145deg,#f03040,#900010); }
  .cb-yellow { background: linear-gradient(145deg,#fde030,#c0a000); color:#222; text-shadow:1px 1px 2px rgba(0,0,0,0.2); }
  .cb-green  { background: linear-gradient(145deg,#26b850,#0c5c28); }
  .cb-blue   { background: linear-gradient(145deg,#1870d0,#013a80); }

  /* Win/lose modal */
  .win-emoji { font-size: 52px; margin-bottom: 8px; animation: winBounce 0.5s cubic-bezier(0.34,1.56,0.64,1); }
  @keyframes winBounce { from { transform:scale(0.4) rotate(-12deg); opacity:0; } to { transform:scale(1) rotate(0deg); opacity:1; } }
  .win-headline { font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 26px; color: var(--gold); text-shadow: 2px 2px 0 #7a5a00; margin-bottom: 8px; }
  .win-sub { font-size: 14px; color: rgba(255,255,255,0.65); margin-bottom: 20px; }
  .btn-restart {
    background: linear-gradient(145deg, var(--gold), #ff8c00);
    color: #1a0a00; padding: 12px 34px; border-radius: 30px; border: none;
    font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 15px;
    cursor: pointer; box-shadow: 0 4px 18px rgba(255,165,0,0.45);
    transition: transform 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn-restart:active { transform: scale(0.94); }

  /* ======= TOAST ======= */
  .toast {
    position: fixed; top: 68px; left: 50%;
    transform: translateX(-50%) translateY(-16px);
    background: rgba(10,10,20,0.9); color: white;
    padding: 7px 18px; border-radius: 20px;
    font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 13px;
    z-index: 600; opacity: 0;
    transition: all 0.28s; white-space: nowrap;
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(6px); pointer-events: none;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ======= CONFETTI ======= */
  .confetti-piece {
    position: fixed; top: -12px;
    animation: confettiFall linear forwards;
    z-index: 700; pointer-events: none;
  }
  @keyframes confettiFall { to { transform: translateY(105vh) rotate(720deg); opacity: 0; } }
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loadScreen">
  <div class="ls-deco"><img src="assets/red_7.png"         onerror="this.parentNode.style.background='#e8192c';this.remove();"></div>
  <div class="ls-deco"><img src="assets/blue_skip.png"     onerror="this.parentNode.style.background='#0156a8';this.remove();"></div>
  <div class="ls-deco"><img src="assets/green_draw2.png"   onerror="this.parentNode.style.background='#1e9e46';this.remove();"></div>
  <div class="ls-deco"><img src="assets/wild_draw4.png"    onerror="this.parentNode.style.background='#333';   this.remove();"></div>
  <div class="ls-deco"><img src="assets/yellow_reverse.png" onerror="this.parentNode.style.background='#f5d400';this.remove();"></div>
  <div class="ls-deco"><img src="assets/red_skip.png"      onerror="this.parentNode.style.background='#e8192c';this.remove();"></div>
  <div class="ls-logo">UNO</div>
  <div class="ls-sub">Classic Card Game</div>
  <div class="ls-bar-wrap"><div class="ls-bar" id="lsBar"></div></div>
  <div class="ls-loading" id="lsLoadingText">Loadingâ€¦</div>
  <button class="ls-tap-btn" id="lsTapBtn" onclick="onTapStart()">â–¶ &nbsp; Tap to Start</button>
</div>

<!-- GAME UI (rendered behind loading screen) -->
<div class="header">
  <div class="logo">UNO</div>
  <div class="status-bar">
    <div class="turn-indicator" id="turnLabel">â€”</div>
    <div class="dir-badge" id="dirLabel">â–¶ Clockwise</div>
  </div>
</div>

<div class="opponent-area">
  <div class="player-info">
    <div class="avatar" id="botAvatar">ðŸ¤–</div>
    <div>
      <div class="pname">UNO Bot</div>
      <div class="pcount" id="botCount">7 cards</div>
    </div>
    <div class="uno-badge" id="botUnoBadge" style="display:none;">UNO!</div>
  </div>
  <div class="bot-hand" id="botHand"></div>
  <div class="thinking" id="thinking" style="display:none;">
    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
  </div>
</div>

<div class="center-area">
  <div class="pile-wrap">
    <div class="pile-label">Draw Pile</div>
    <div class="deck-stack" onclick="playerDraw()">
      <div class="sh"></div><div class="sh"></div>
      <div class="deck-top"><img src="assets/card_back.png" alt="deck" onerror="this.style.display='none';this.parentNode.style.background='linear-gradient(145deg,#1a3a8a,#0d2060)';"></div>
    </div>
  </div>

  <div class="game-mid">
    <div class="color-swatch" id="colorSwatch"></div>
    <div class="color-label" id="colorLabel">â€”</div>
  </div>

  <div class="pile-wrap">
    <div class="pile-label">Discard</div>
    <div class="discard-pile" id="discardPile"></div>
  </div>
</div>

<div class="player-area">
  <div class="your-info">
    <div>
      <div class="your-name">You</div>
      <div class="your-count" id="yourCount">7 cards</div>
    </div>
    <div class="uno-badge" id="yourUnoBadge" style="display:none;">UNO!</div>
  </div>
  <div class="scroll-hint" id="scrollHint"></div>
  <div class="hand-container" id="playerHand"></div>
</div>

<div class="action-bar">
  <button class="btn btn-draw" id="btnDraw" onclick="playerDraw()">
    <img src="assets/btn_draw.png" alt="Draw"
      onerror="this.outerHTML='<span style=&quot;padding:10px 22px;background:linear-gradient(145deg,#2980b9,#1a5276);color:white;font-family:Nunito,sans-serif;font-weight:900;font-size:15px;border-radius:30px;&quot;>Draw</span>'">
  </button>
  <button class="btn btn-uno" id="btnUno" onclick="callUno()" disabled>
    <img src="assets/btn_uno.png" alt="UNO!"
      onerror="this.outerHTML='<span style=&quot;padding:10px 22px;background:linear-gradient(145deg,#e8192c,#8b0000);color:white;font-family:Nunito,sans-serif;font-weight:900;font-size:15px;border-radius:30px;&quot;>UNO!</span>'">
  </button>
</div>

<div class="toast" id="toast"></div>

<!-- COLOR PICKER -->
<div class="overlay" id="colorModal" style="display:none;">
  <div class="modal">
    <div class="modal-title">Choose a Color</div>
    <div class="modal-sub">Pick the active color for your wild card</div>
    <div class="color-grid">
      <button class="color-btn cb-red"    onclick="sfx('cardTouch'); pickColor('red')">Red</button>
      <button class="color-btn cb-yellow" onclick="sfx('cardTouch'); pickColor('yellow')">Yellow</button>
      <button class="color-btn cb-green"  onclick="sfx('cardTouch'); pickColor('green')">Green</button>
      <button class="color-btn cb-blue"   onclick="sfx('cardTouch'); pickColor('blue')">Blue</button>
    </div>
  </div>
</div>

<!-- WIN / LOSE -->
<div class="overlay" id="winModal" style="display:none;">
  <div class="modal">
    <div class="win-emoji"    id="winEmoji">ðŸŽ‰</div>
    <div class="win-headline" id="winHeadline">You Win!</div>
    <div class="win-sub"      id="winSub">You cleared your hand!</div>
    <button class="btn-restart" onclick="sfx('cardTouch'); startGame()">Play Again</button>
  </div>
</div>

<script>
// ================================================================
//  SOUND ENGINE â€” simple, reliable, no over-engineering
// ================================================================
const SOUNDS = {};

function loadSound(key, src, loop, vol) {
  const a = new Audio(src);
  a.preload = 'auto';
  if (loop) a.loop = true;
  a.volume = vol || 1.0;
  SOUNDS[key] = a;
}

// Load all sounds
loadSound('theme',    'assets/Theme_song.mp3', true,  0.35);
loadSound('lastCard', 'assets/Last_card.mp3',  true,  0.55);
loadSound('cardTouch','assets/Card_touch.mp3', false, 0.75);
loadSound('cardPlay', 'assets/Card_play.mp3',  false, 1.0);
loadSound('draw',     'assets/Draw.mp3',        false, 0.85);
loadSound('uno',      'assets/Uno.mp3',         false, 1.0);
loadSound('win',      'assets/Win.mp3',         false, 1.0);
loadSound('lose',     'assets/Lose.mp3',        false, 1.0);

let themeStarted   = false;
let tensionActive  = false;

// Play a one-shot SFX (cloned so overlaps work)
function sfx(key) {
  try {
    const s = SOUNDS[key];
    if (!s) return;
    const c = s.cloneNode();
    c.volume = s.volume;
    c.play().catch(() => {});
  } catch(e) {}
}

// Smooth volume fade
function fadeTo(audio, targetVol, ms) {
  const start = audio.volume;
  const diff  = targetVol - start;
  const steps = 25;
  const dt    = ms / steps;
  let i = 0;
  const iv = setInterval(() => {
    i++;
    audio.volume = Math.max(0, Math.min(1, start + diff * (i / steps)));
    if (i >= steps) clearInterval(iv);
  }, dt);
}

// Start theme music (called once on first user gesture OR autoplay)
function startTheme() {
  if (themeStarted) return;
  themeStarted = true;
  const theme = SOUNDS['theme'];
  theme.currentTime = 0;
  theme.volume = 0;
  theme.play().then(() => fadeTo(theme, 0.35, 1200)).catch(() => {
    // Should not fail since we call this inside a gesture
  });
}

// Restart theme for new game
function restartTheme() {
  const theme = SOUNDS['theme'];
  theme.currentTime = 0;
  theme.volume = 0;
  theme.play().then(() => fadeTo(theme, 0.35, 1000)).catch(() => {});
}

// Stop all music (win/lose)
function stopMusic() {
  fadeTo(SOUNDS['theme'], 0, 500);
  setTimeout(() => SOUNDS['theme'].pause(), 550);
  if (tensionActive) {
    fadeTo(SOUNDS['lastCard'], 0, 400);
    setTimeout(() => { SOUNDS['lastCard'].pause(); SOUNDS['lastCard'].currentTime = 0; }, 450);
    tensionActive = false;
  }
}

// Switch to tension music when someone has 1 card
function checkTension() {
  const anyone1 = playerHand.length === 1 || botHand.length === 1;
  if (anyone1 && !tensionActive && themeStarted) {
    tensionActive = true;
    fadeTo(SOUNDS['theme'], 0.08, 700);
    SOUNDS['lastCard'].currentTime = 0;
    SOUNDS['lastCard'].play().catch(() => {});
    fadeTo(SOUNDS['lastCard'], 0.55, 700);
  } else if (!anyone1 && tensionActive) {
    tensionActive = false;
    fadeTo(SOUNDS['lastCard'], 0, 500);
    setTimeout(() => { SOUNDS['lastCard'].pause(); SOUNDS['lastCard'].currentTime = 0; }, 550);
    fadeTo(SOUNDS['theme'], 0.35, 700);
  }
}

// Reset tension on new game
function resetTension() {
  tensionActive = false;
  SOUNDS['lastCard'].pause();
  SOUNDS['lastCard'].currentTime = 0;
  SOUNDS['lastCard'].volume = 0.55;
}

// ================================================================
//  CARD HELPERS
// ================================================================
const FALLBACK = { red:'#e8192c', yellow:'#f5d400', green:'#1e9e46', blue:'#0156a8', wild:'#333' };
const SYM = { skip:'âŠ˜', reverse:'â†º', draw2:'+2', wild:'âœ¦', wild_draw4:'+4' };

function cardFile(card) {
  if (card.value === 'wild')       return 'assets/wild.png';
  if (card.value === 'wild_draw4') return 'assets/wild_draw4.png';
  return `assets/${card.color}_${card.value}.png`;
}

function makeImg(card) {
  const wrap = document.createElement('div');
  wrap.style.cssText = 'width:100%;height:100%;border-radius:inherit;overflow:hidden;';
  const img = document.createElement('img');
  img.src = cardFile(card);
  img.alt = `${card.color} ${card.value}`;
  img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;pointer-events:none;';
  img.onerror = () => {
    img.remove();
    const fb = document.createElement('div');
    const bg = FALLBACK[card.color] || '#333';
    fb.style.cssText = `width:100%;height:100%;background:${bg};border-radius:inherit;display:flex;align-items:center;justify-content:center;font-family:Nunito,sans-serif;font-weight:900;font-size:22px;color:white;`;
    fb.textContent = SYM[card.value] || card.value;
    wrap.appendChild(fb);
  };
  wrap.appendChild(img);
  return wrap;
}

function makeBack() {
  const wrap = document.createElement('div');
  wrap.style.cssText = 'width:100%;height:100%;border-radius:inherit;overflow:hidden;';
  const img = document.createElement('img');
  img.src = 'assets/card_back.png';
  img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;pointer-events:none;';
  img.onerror = () => {
    img.remove();
    const fb = document.createElement('div');
    fb.style.cssText = 'width:100%;height:100%;background:linear-gradient(145deg,#1a3a8a,#0d2060);border-radius:inherit;display:flex;align-items:center;justify-content:center;font-family:Nunito,sans-serif;font-weight:900;font-size:18px;color:#e8192c;';
    fb.textContent = 'UNO';
    wrap.appendChild(fb);
  };
  wrap.appendChild(img);
  return wrap;
}

// ================================================================
//  GAME DATA
// ================================================================
const COLORS   = ['red','yellow','green','blue'];
const NUMBERS  = ['0','1','2','3','4','5','6','7','8','9'];
const SPECIALS = ['skip','reverse','draw2'];

const COLOR_META = {
  red:    { hex:'#e8192c', glow:'rgba(232,25,44,0.6)',  label:'Red'    },
  yellow: { hex:'#f5d400', glow:'rgba(245,212,0,0.6)',  label:'Yellow' },
  green:  { hex:'#1e9e46', glow:'rgba(30,158,70,0.6)',  label:'Green'  },
  blue:   { hex:'#0156a8', glow:'rgba(1,86,168,0.6)',   label:'Blue'   },
};

let deck = [], playerHand = [], botHand = [], discardPile = [];
let currentColor = '', currentValue = '';
let isPlayerTurn = false, direction = 1;
let selectedCard = null, pendingWild = null;
let lastDrawnCard = null;  // track newest drawn card for deal animation
let gameActive = false, unoCalled = false;

// ================================================================
//  DECK
// ================================================================
function buildDeck() {
  const d = [];
  for (const c of COLORS) {
    d.push({color:c, value:'0'});
    for (const n of NUMBERS.slice(1)) { d.push({color:c,value:n}); d.push({color:c,value:n}); }
    for (const s of SPECIALS)         { d.push({color:c,value:s}); d.push({color:c,value:s}); }
  }
  for (const w of ['wild','wild_draw4']) for (let i=0;i<4;i++) d.push({color:'wild',value:w});
  return d;
}

function shuffle(a) {
  for (let i=a.length-1;i>0;i--) { const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}

function drawFrom(n=1) {
  const out = [];
  for (let i=0;i<n;i++) {
    if (deck.length === 0) {
      if (discardPile.length <= 1) break;
      const top = discardPile.pop();
      deck = shuffle([...discardPile]);
      discardPile = [top];
      toast('Deck reshuffled!');
    }
    if (deck.length > 0) out.push(deck.pop());
  }
  return out;
}

// ================================================================
//  GAME INIT
// ================================================================
function startGame() {
  deck = shuffle(buildDeck());
  playerHand = drawFrom(7);
  botHand    = drawFrom(7);
  discardPile = [];
  direction = 1;
  selectedCard = pendingWild = null;
  gameActive = true;
  unoCalled  = false;
  isPlayerTurn = true;

  resetTension();
  if (themeStarted) restartTheme();

  document.getElementById('winModal').style.display   = 'none';
  document.getElementById('colorModal').style.display = 'none';

  // First card â€” no wilds
  let start;
  do { start = deck.pop(); if (start.color === 'wild') deck.unshift(start); }
  while (start.color === 'wild');

  discardPile.push(start);
  currentColor = start.color;
  currentValue = start.value;

  if      (start.value === 'skip')    { isPlayerTurn = false; }
  else if (start.value === 'reverse') { isPlayerTurn = true; }
  else if (start.value === 'draw2')   { playerHand.push(...drawFrom(2)); isPlayerTurn = false; }

  renderAll();
  if (!isPlayerTurn) setTimeout(botTurn, 1100);
}

// ================================================================
//  CANPLAY
// ================================================================
function canPlay(card) {
  if (card.color === 'wild') return true;
  return card.color === currentColor || card.value === currentValue;
}

// ================================================================
//  APPLY CARD EFFECT
// ================================================================
function applyCard(card, byBot) {
  const hand = byBot ? botHand : playerHand;
  hand.splice(hand.indexOf(card), 1);
  discardPile.push(card);
  currentValue = card.value;
  if (card.color !== 'wild') currentColor = card.color;

  // Default: switch turns
  isPlayerTurn = byBot;

  if (card.value === 'skip') {
    isPlayerTurn = byBot;
    toast(byBot ? 'Bot skips your turn!' : "Bot's turn skipped!");
  } else if (card.value === 'reverse') {
    direction *= -1;
    isPlayerTurn = byBot; // 2-player: reverse = skip
    toast(byBot ? 'Reversed â€” bot goes again!' : 'Reversed â€” you go again!');
  } else if (card.value === 'draw2') {
    sfx('draw'); // play ONCE for the whole penalty
    if (byBot) { const pen=drawFrom(2); lastDrawnCard=pen[pen.length-1]; playerHand.push(...pen); isPlayerTurn = false; toast('You draw 2!'); }
    else       { botHand.push(...drawFrom(2));    isPlayerTurn = true;  toast('Bot draws 2!'); }
  }
}

// ================================================================
//  PLAYER ACTIONS
// ================================================================
function onCardTap(card, el) {
  if (!isPlayerTurn || !gameActive) return;

  if (!canPlay(card)) {
    // Can't play â€” touch sound + shake
    sfx('cardTouch');
    toast("Can't play that card!");
    el.animate([
      {transform:'translateX(-6px) translateY(-22px) scale(1.07)'},
      {transform:'translateX(6px)  translateY(-22px) scale(1.07)'},
      {transform:'translateX(-5px) translateY(-22px) scale(1.07)'},
      {transform:'translateX(5px)  translateY(-22px) scale(1.07)'},
      {transform:'translateY(-22px) scale(1.07)'}
    ], {duration:300});
    return;
  }

  if (selectedCard === card) {
    // â”€â”€ Second tap: PLAY / THROW the card â”€â”€
    sfx('cardPlay');
    // Animate the card flying to discard before processing
    el.classList.remove('selected');
    el.classList.add('throwing');
    selectedCard = null;
    setTimeout(() => {
      if (card.value === 'wild' || card.value === 'wild_draw4') {
        pendingWild = card;
        document.getElementById('colorModal').style.display = 'flex';
        renderAll();
      } else {
        applyCard(card, false);
        checkWin();
        checkTension();
        renderAll();
        // Pop-in on discard pile
        const dp = document.getElementById('discardPile');
        dp.classList.add('pop-in');
        setTimeout(() => dp.classList.remove('pop-in'), 320);
        if (gameActive && !isPlayerTurn) setTimeout(botTurn, 900);
      }
    }, 220);
  } else {
    // â”€â”€ First tap: SELECT / PICK UP the card â”€â”€
    sfx('cardTouch'); // soft pick-up sound
    selectedCard = card;
    renderHand();
  }
}

function pickColor(color) {
  document.getElementById('colorModal').style.display = 'none';
  if (!pendingWild) return;
  const card = pendingWild;
  pendingWild = null;

  playerHand.splice(playerHand.indexOf(card), 1);
  discardPile.push(card);
  currentValue = card.value;
  currentColor = color;

  if (card.value === 'wild_draw4') {
    sfx('draw'); // play ONCE for the whole penalty
    botHand.push(...drawFrom(4));
    isPlayerTurn = true;
    toast(`You chose ${color} â€” Bot draws 4!`);
    lastDrawnCard = null;
  } else {
    isPlayerTurn = false;
    toast(`Color: ${color}!`);
  }

  selectedCard = null;
  checkWin();
  checkTension();
  renderAll();
  if (gameActive && !isPlayerTurn) setTimeout(botTurn, 900);
}

function playerDraw() {
  if (!isPlayerTurn || !gameActive) return;
  const drawn = drawFrom(1);
  if (!drawn.length) return;
  sfx('draw');
  lastDrawnCard = drawn[0];
  playerHand.push(drawn[0]);
  toast('You drew a card');
  isPlayerTurn = false;
  selectedCard = null;
  unoCalled    = false;
  renderAll();
  lastDrawnCard = null;
  setTimeout(botTurn, 900);
}

function callUno() {
  if (!isPlayerTurn || !gameActive || playerHand.length !== 2) return;
  unoCalled = true;
  sfx('uno');
  toast('UNO! ðŸŽ‰');
  document.getElementById('btnUno').disabled = true;
}

// ================================================================
//  BOT AI
// ================================================================
function botPickColor() {
  const cnt = {red:0,yellow:0,green:0,blue:0};
  for (const c of botHand) if (c.color !== 'wild') cnt[c.color]++;
  return Object.entries(cnt).sort((a,b)=>b[1]-a[1])[0][0];
}

function botTurn() {
  if (!gameActive || isPlayerTurn) return;
  document.getElementById('thinking').style.display = 'flex';

  setTimeout(() => {
    document.getElementById('thinking').style.display = 'none';
    if (!gameActive || isPlayerTurn) return;

    const playable = botHand.filter(canPlay);
    let card = null;

    if (playable.length > 0) {
      const sp = playable.filter(c => SPECIALS.includes(c.value));
      const nm = playable.filter(c => !isNaN(c.value));
      const wi = playable.filter(c => c.color === 'wild');
      card = sp.length ? sp[Math.floor(Math.random()*sp.length)]
           : nm.length ? nm[Math.floor(Math.random()*nm.length)]
           : wi[Math.floor(Math.random()*wi.length)];
    }

    if (card) {
      sfx('cardPlay');
      if (card.value === 'wild' || card.value === 'wild_draw4') {
        botHand.splice(botHand.indexOf(card), 1);
        discardPile.push(card);
        currentValue = card.value;
        currentColor = botPickColor();
        if (card.value === 'wild_draw4') {
          sfx('draw'); // play ONCE for the whole penalty
          const pen4=drawFrom(4); lastDrawnCard=pen4[pen4.length-1]; playerHand.push(...pen4);
          isPlayerTurn = true;
          toast(`Bot chose ${currentColor} â€” you draw 4!`);
        } else {
          isPlayerTurn = true;
          toast(`Bot chose ${currentColor}!`);
        }
      } else {
        applyCard(card, true);
      }
      if (botHand.length === 1) { sfx('uno'); toast('Bot says UNO!'); }
      checkWin();
      checkTension();
      renderAll();
      // Pop-in on discard for bot play
      const dp2 = document.getElementById('discardPile');
      dp2.classList.add('pop-in');
      setTimeout(() => dp2.classList.remove('pop-in'), 320);
      if (gameActive && !isPlayerTurn) setTimeout(botTurn, 900);
    } else {
      // Draw a card
      const drawn = drawFrom(1);
      sfx('draw');
      botHand.push(...drawn);
      toast('Bot draws a card');
      isPlayerTurn = true;
      renderAll();
      // Animate the last bot card deal-in
      const botCards = document.querySelectorAll('.bot-card');
      const lastBotCard = botCards[botCards.length - 1];
      if (lastBotCard) {
        lastBotCard.classList.add('deal-in');
        setTimeout(() => lastBotCard.classList.remove('deal-in'), 380);
      }
    }
  }, 750 + Math.random() * 500);
}

// ================================================================
//  WIN CHECK
// ================================================================
function checkWin() {
  if (playerHand.length === 0) { endGame('player'); return; }
  if (botHand.length === 0)    { endGame('bot');    return; }

  // UNO penalty
  if (!isPlayerTurn && playerHand.length === 1 && !unoCalled) {
    setTimeout(() => {
      if (!gameActive) return;
      sfx('draw');
      toast('Forgot UNO! Draw 2!');
      playerHand.push(...drawFrom(2));
      checkTension();
      renderAll();
    }, 600);
  }
}

function endGame(winner) {
  gameActive = false;
  stopMusic();
  setTimeout(() => sfx(winner === 'player' ? 'win' : 'lose'), 400);

  if (winner === 'player') {
    document.getElementById('winEmoji').textContent    = 'ðŸŽ‰';
    document.getElementById('winHeadline').textContent = 'You Win!';
    document.getElementById('winSub').textContent      = 'You cleared your hand â€” UNO champion!';
    spawnConfetti();
  } else {
    document.getElementById('winEmoji').textContent    = 'ðŸ¤–';
    document.getElementById('winHeadline').textContent = 'Bot Wins!';
    document.getElementById('winSub').textContent      = 'Better luck next round!';
  }
  document.getElementById('winModal').style.display = 'flex';
}

function spawnConfetti() {
  const cols = ['#e8192c','#f5d400','#1e9e46','#0156a8','#fff','#FFD700','#ff69b4'];
  for (let i = 0; i < 70; i++) {
    const c = document.createElement('div');
    c.className = 'confetti-piece';
    const sz = 6 + Math.random() * 8;
    c.style.cssText = `left:${Math.random()*100}vw;width:${sz}px;height:${sz}px;background:${cols[Math.floor(Math.random()*cols.length)]};animation-duration:${1.5+Math.random()*2}s;animation-delay:${Math.random()*0.8}s;border-radius:${Math.random()>0.5?'50%':'2px'};`;
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 4000);
  }
}

// ================================================================
//  RENDER
// ================================================================
function renderDiscard() {
  if (!discardPile.length) return;
  const top = discardPile[discardPile.length - 1];
  const pile = document.getElementById('discardPile');
  pile.innerHTML = '';
  pile.style.borderRadius = 'var(--radius)';
  const el = makeImg(top);
  el.style.borderRadius = 'var(--radius)';
  pile.appendChild(el);

  const meta = COLOR_META[currentColor];
  pile.style.boxShadow = meta ? `0 4px 20px rgba(0,0,0,0.5), 0 0 28px ${meta.glow}` : '0 4px 20px rgba(0,0,0,0.5)';

  const swatch = document.getElementById('colorSwatch');
  const label  = document.getElementById('colorLabel');
  if (meta) {
    swatch.style.background  = meta.hex;
    swatch.style.boxShadow   = `0 0 14px ${meta.glow}`;
    label.textContent = meta.label;
  }
}

function renderBotHand() {
  const c = document.getElementById('botHand');
  c.innerHTML = '';
  const show = Math.min(botHand.length, 12);
  for (let i = 0; i < show; i++) {
    const el = document.createElement('div');
    el.className = 'bot-card';
    el.appendChild(makeBack());
    c.appendChild(el);
  }
  document.getElementById('botCount').textContent = `${botHand.length} card${botHand.length !== 1 ? 's' : ''}`;
  document.getElementById('botUnoBadge').style.display = botHand.length === 1 ? 'block' : 'none';
  document.getElementById('botAvatar').classList.toggle('active', !isPlayerTurn);
}

function renderHand() {
  const c = document.getElementById('playerHand');
  c.innerHTML = '';

  // Get deck position for deal-in animation origin
  const deckEl = document.querySelector('.deck-stack');
  const handEl = document.getElementById('playerHand');
  let deckRect = deckEl ? deckEl.getBoundingClientRect() : null;
  let handRect = handEl ? handEl.getBoundingClientRect() : null;

  for (const card of playerHand) {
    const el = document.createElement('div');
    el.className = 'hand-card';

    if (isPlayerTurn && canPlay(card))  el.classList.add('playable');
    if (isPlayerTurn && !canPlay(card)) el.classList.add('dead');
    if (selectedCard === card)          el.classList.add('selected');

    const imgWrap = makeImg(card);
    imgWrap.style.borderRadius = 'var(--radius)';
    imgWrap.style.overflow = 'hidden';
    el.appendChild(imgWrap);

    // "Tap to Play" bubble
    const lbl = document.createElement('div');
    lbl.className = 'tap-label';
    lbl.textContent = 'â–¶ Tap to Play';
    el.appendChild(lbl);

    // If this is the newly drawn card, animate it flying from deck
    if (card === lastDrawnCard && deckRect && handRect) {
      const dx = deckRect.left + deckRect.width/2 - (handRect.left + handRect.width/2);
      const dy = deckRect.top  - (handRect.top + handRect.height/2);
      el.style.setProperty('--dx', dx + 'px');
      el.style.setProperty('--dy', dy + 'px');
      el.classList.add('deal-in');
      setTimeout(() => el.classList.remove('deal-in'), 450);
    }

    el.addEventListener('click', () => onCardTap(card, el));
    c.appendChild(el);
  }

  document.getElementById('yourCount').textContent = `${playerHand.length} card${playerHand.length !== 1 ? 's' : ''}`;
  document.getElementById('yourUnoBadge').style.display = playerHand.length === 1 ? 'block' : 'none';
  document.getElementById('scrollHint').textContent = playerHand.length > 7 ? 'â† scroll for more â†’' : '';
  document.getElementById('btnDraw').disabled = !isPlayerTurn || !gameActive;
  document.getElementById('btnUno').disabled  = !(isPlayerTurn && playerHand.length === 2 && gameActive);
}

function renderTurn() {
  const lbl = document.getElementById('turnLabel');
  lbl.textContent = isPlayerTurn ? 'Your Turn' : "Bot's Turn";
  lbl.classList.toggle('your-turn', isPlayerTurn);
  document.getElementById('dirLabel').textContent = direction === 1 ? 'â–¶ Clockwise' : 'â—€ Counter-CW';
}

function renderAll() {
  renderDiscard();
  renderBotHand();
  renderHand();
  renderTurn();
}

// ================================================================
//  TOAST
// ================================================================
let toastTimer;
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

// ================================================================
//  BOOT â€” loading screen + music
// ================================================================
// Initialize game state immediately (hidden behind loader)
startGame();

// â”€â”€ LOADING SCREEN â”€â”€
// Fill bar over 1.3s, then reveal the TAP TO START button.
// The button tap IS the user gesture â€” guaranteed to unlock audio on all browsers.
requestAnimationFrame(() => {
  const bar = document.getElementById('lsBar');
  if (bar) bar.style.width = '100%';
});

setTimeout(() => {
  // Swap "Loadingâ€¦" text for the tap button
  const txt = document.getElementById('lsLoadingText');
  const btn = document.getElementById('lsTapBtn');
  if (txt) txt.style.display = 'none';
  if (btn) btn.style.display = 'block';
}, 1500);

function onTapStart() {
  sfx('cardTouch');
  // Hide the loading screen
  const ls = document.getElementById('loadScreen');
  if (ls) {
    ls.classList.add('out');
    setTimeout(() => ls.remove(), 520);
  }

  // THIS is the user gesture â€” audio is guaranteed to play now
  themeStarted = true;
  SOUNDS['theme'].volume = 0;
  SOUNDS['theme'].play().then(() => {
    fadeTo(SOUNDS['theme'], 0.35, 1200);
  }).catch(() => {});
}
</script>
</body>
</html>